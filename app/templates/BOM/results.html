{% extends "base.html" %}
{% import "bootstrap/wtf.html" as wtf %}
{% import "_macros.html" as macros %}

{% block title %}

    {{ super() }}

    Page Title

{% endblock %}

{% block page_content %}

    <div class="ui raised equal width grid segment">
        <div class=" column">
            <p>
                <strong>Job Number: </strong> {{ result.job_number }} <br>
                <strong>Comment: </strong> {{ result.comment }} <br>
                <strong>File Used: </strong> {{ result.file.name }} <br>
                <strong>Create Date: </strong> {{ result.timestamp }} <br>
                <strong>Result Reference: </strong> {{ result.id }}
            </p>
        </div>
        <div class="column">
                <a class="ui primary button" href="{{ url_for('BOM.BOM_setup') }}"><i class="power off icon"></i> Rerun BOM Tool</a></li>
        </div>
    </div>
        <h1 class="header">Required Materials</h1>

  <table class="ui celled striped table center aligned">
    <tr class="ui header">
      <th></th>
      <th>Average</th>
      <th>High</th>
      <th>Low</th>

      {% for length in lengths %}
        <th>{{ length }}</th>
      {% endfor %}
    </tr>
    {% for material in result.material_review() %}
      <tr>
        {% if result.material_missing(material) %}
          <td class="ui collapsing header">
            <div class="ui red ribbon large header label">{{ material }} - Parts Missing</div>
          </td>
        {% else %}
          <td class="ui collapsing header">{{ material }}</td>
        {% endif %}
        <td>{{ result.material_average_percentage(material) }}%</td>
        <td>{{ result.material_high_percentage(material) }}%</td>
        <td>{{ result.material_low_percentage(material) }}%</td>

        {% set ns = namespace(found=false, length=0, count=lengths|length) %}

        {% for required in result.required_lengths(material)|reverse %}
          {% if  result.required_lengths(material)|length > 1 %}
            {% set ns.found = false %}
            {% set ns.count = ns.count - 1 %}

            {% for length in lengths %}
              {% if required == length %}
                <td class="warning">{{ result.required_length_qty(material, required) }}</td>
                {% set ns.found = true %}
                {% set ns.length = length %}
              {% elif not ns.found %}
                {% if length != ns.length and ns.count > 0 %}
                  <td></td>
                  {% set ns.count = ns.count - 1 %}
                {% endif %}
              {% endif %}
            {% endfor %}

          {% else %}
            {% for length in lengths %}
              {% if length in result.required_lengths(material) %}
                {% if required == length %}
                  <td class="warning">{{ result.required_length_qty(material, required) }}</td>

                {% endif %}

              {% else %}
                <td></td>
              {% endif %}
            {% endfor %}
          {% endif %}
        {% endfor %}
      </tr>
    {% endfor %}

  </table>



{% if result.has_missing_parts() %}
  <h1 class="header">Missing Parts</h1>

<div class="ui raised segment">
        {% for material in result.material_review() %}
            {% if result.is_missing_parts_for_material(material) %}
            <div class="ui vertical segment">
            <h3 class="header">Parts missing in {{ material }}</h3>
            <div class="ui equal width grid">
            <br>
        {% for part in result.get_missing_parts_for_material(material) %}

                {% include("BOM/_part_result.html") %}
            {% endfor %}
            </div>
            </div>
            {% endif %}
        {% endfor %}
</div>

    {% endif %}

<h1 class="header">Used Beams</h1>

    <div class="ui raised stackable gird segment">
        {% for material in result.material_review() %}

            {% include("BOM/_beam.html") %}

        {% endfor %}

    </div>


{% endblock %}

{% block scripts %}
    {{ super() }}
{% endblock %}
